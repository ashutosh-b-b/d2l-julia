import{_ as r,c as i,o as t,j as a,aA as o,a as l}from"./chunks/framework.DjA5121Y.js";const n="/d2l-julia/previews/PR1/assets/multi-head-attention.DzwgICHw.svg",t1=JSON.parse('{"title":"Multi-Head Attention","description":"","frontmatter":{},"headers":[],"relativePath":"CH10.Attention_Mechanisms_and_Transformers/ATTN_5.md","filePath":"CH10.Attention_Mechanisms_and_Transformers/ATTN_5.md","lastUpdated":null}'),e={name:"CH10.Attention_Mechanisms_and_Transformers/ATTN_5.md"},Q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},p={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},h={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},d={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},T={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.446ex",height:"2.37ex",role:"img",focusable:"false",viewBox:"0 -853.7 3290.9 1047.7","aria-hidden":"true"},u={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.09ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.515ex",height:"2.022ex",role:"img",focusable:"false",viewBox:"0 -853.7 3321.4 893.7","aria-hidden":"true"},B={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.09ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.474ex",height:"2.022ex",role:"img",focusable:"false",viewBox:"0 -853.7 3303.4 893.7","aria-hidden":"true"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},x={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.185ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 966 851.8","aria-hidden":"true"},f={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.273ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 4982.6 888","aria-hidden":"true"},w={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},F={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.682ex"},xmlns:"http://www.w3.org/2000/svg",width:"35.754ex",height:"3.082ex",role:"img",focusable:"false",viewBox:"0 -1060.7 15803.3 1362.3","aria-hidden":"true"},M={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.682ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.633ex",height:"3.082ex",role:"img",focusable:"false",viewBox:"0 -1060.7 6025.8 1362.3","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.682ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.869ex",height:"3.082ex",role:"img",focusable:"false",viewBox:"0 -1060.7 6130 1362.3","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.682ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.73ex",height:"3.082ex",role:"img",focusable:"false",viewBox:"0 -1060.7 6068.5 1362.3","aria-hidden":"true"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.244ex",height:"2.059ex",role:"img",focusable:"false",viewBox:"0 -705 550 910","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.379ex",height:"2.288ex",role:"img",focusable:"false",viewBox:"0 -853.7 5913.7 1011.5","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},S={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-4.355ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.306ex",height:"9.842ex",role:"img",focusable:"false",viewBox:"0 -2425 7207.3 4350","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},P={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.91ex",height:"2.347ex",role:"img",focusable:"false",viewBox:"0 -750 8800.2 1037.2","aria-hidden":"true"},X={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},N={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.303ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 576 705","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},G={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.385ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 9452.2 981.2","aria-hidden":"true"},J={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.102ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 928.9 636","aria-hidden":"true"};function U(Y,s,K,a1,s1,l1){return t(),i("div",null,[s[78]||(s[78]=a("h1",{id:"Multi-Head-Attention",tabindex:"-1"},[l("Multi-Head Attention "),a("a",{class:"header-anchor",href:"#Multi-Head-Attention","aria-label":'Permalink to "Multi-Head Attention {#Multi-Head-Attention}"'},"​")],-1)),s[79]||(s[79]=a("p",null,"In practice, given the same set of queries, keys, and values we may want our model to combine knowledge from different behaviors of the same attention mechanism, such as capturing dependencies of various ranges (e.g., shorter-range vs. longer-range) within a sequence. Thus, it may be beneficial to allow our attention mechanism to jointly use different representation subspaces of queries, keys, and values.",-1)),a("p",null,[s[8]||(s[8]=l("To this end, instead of performing a single attention pooling, queries, keys, and values can be transformed with ")),a("mjx-container",Q,[(t(),i("svg",p,s[0]||(s[0]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[1]||(s[1]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[9]||(s[9]=l(" independently learned linear projections. Then these ")),a("mjx-container",h,[(t(),i("svg",d,s[2]||(s[2]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[3]||(s[3]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[10]||(s[10]=l(" projected queries, keys, and values are fed into attention pooling in parallel. In the end, ")),a("mjx-container",T,[(t(),i("svg",k,s[4]||(s[4]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[5]||(s[5]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[11]||(s[11]=l(" attention-pooling outputs are concatenated and transformed with another learned linear projection to produce the final output. This design is called ")),s[12]||(s[12]=a("em",null,"multi-head attention",-1)),s[13]||(s[13]=l(", where each of the ")),a("mjx-container",y,[(t(),i("svg",m,s[6]||(s[6]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[7]||(s[7]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[14]||(s[14]=l(" attention pooling outputs is a ")),s[15]||(s[15]=a("em",null,"head",-1)),s[16]||(s[16]=l(" [")),s[17]||(s[17]=a("a",{href:"/d2l-julia/previews/PR1/references#Vaswani_Shazeer_Parmar_ea_2017"},"142",-1)),s[18]||(s[18]=l("]. Using fully connected layers to perform learnable linear transformations, ")),s[19]||(s[19]=a("a",{href:"/d2l-julia/previews/PR1/CH10.Attention_Mechanisms_and_Transformers/ATTN_5#fig_multi-head-attention"},"Figure",-1)),s[20]||(s[20]=l(" describes multi-head attention. ")),s[21]||(s[21]=a("img",{src:n,id:"fig_multi-head-attention"},null,-1))]),s[80]||(s[80]=o("",4)),a("p",null,[s[32]||(s[32]=l("Before providing the implementation of multi-head attention, let's formalize this model mathematically. Given a query ")),a("mjx-container",g,[(t(),i("svg",A,s[22]||(s[22]=[o("",1)]))),s[23]||(s[23]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"q")]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"d"),a("mi",null,"q")])])])])],-1))]),s[33]||(s[33]=l(", a key ")),a("mjx-container",u,[(t(),i("svg",c,s[24]||(s[24]=[o("",1)]))),s[25]||(s[25]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"k")]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"d"),a("mi",null,"k")])])])])],-1))]),s[34]||(s[34]=l(", and a value ")),a("mjx-container",B,[(t(),i("svg",E,s[26]||(s[26]=[o("",1)]))),s[27]||(s[27]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"v")]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"d"),a("mi",null,"v")])])])])],-1))]),s[35]||(s[35]=l(", each attention head ")),a("mjx-container",L,[(t(),i("svg",x,s[28]||(s[28]=[o("",1)]))),s[29]||(s[29]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"h")]),a("mi",null,"i")])])],-1))]),s[36]||(s[36]=l(" (")),a("mjx-container",f,[(t(),i("svg",H,s[30]||(s[30]=[o("",1)]))),s[31]||(s[31]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"i"),a("mo",null,"="),a("mn",null,"1"),a("mo",null,","),a("mo",null,"…"),a("mo",null,","),a("mi",null,"h")])],-1))]),s[37]||(s[37]=l(") is computed as"))]),a("mjx-container",w,[(t(),i("svg",F,s[38]||(s[38]=[o("",1)]))),s[39]||(s[39]=a("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"h")]),a("mi",null,"i")]),a("mo",null,"="),a("mi",null,"f"),a("mo",{stretchy:"false"},"("),a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"q"),a("mo",{stretchy:"false"},")")])]),a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"q")]),a("mo",null,","),a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"k"),a("mo",{stretchy:"false"},")")])]),a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"k")]),a("mo",null,","),a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"v"),a("mo",{stretchy:"false"},")")])]),a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"v")]),a("mo",{stretchy:"false"},")"),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"v")])])]),a("mo",null,",")])],-1))]),a("p",null,[s[52]||(s[52]=l("where ")),a("mjx-container",M,[(t(),i("svg",b,s[40]||(s[40]=[o("",1)]))),s[41]||(s[41]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"q"),a("mo",{stretchy:"false"},")")])]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"q")]),a("mo",null,"×"),a("msub",null,[a("mi",null,"d"),a("mi",null,"q")])])])])],-1))]),s[53]||(s[53]=l(", ")),a("mjx-container",D,[(t(),i("svg",C,s[42]||(s[42]=[o("",1)]))),s[43]||(s[43]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"k"),a("mo",{stretchy:"false"},")")])]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"k")]),a("mo",null,"×"),a("msub",null,[a("mi",null,"d"),a("mi",null,"k")])])])])],-1))]),s[54]||(s[54]=l(", and ")),a("mjx-container",v,[(t(),i("svg",_,s[44]||(s[44]=[o("",1)]))),s[45]||(s[45]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msubsup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"i"),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",{stretchy:"false"},"("),a("mi",null,"v"),a("mo",{stretchy:"false"},")")])]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"v")]),a("mo",null,"×"),a("msub",null,[a("mi",null,"d"),a("mi",null,"v")])])])])],-1))]),s[55]||(s[55]=l(" are learnable parameters and ")),a("mjx-container",V,[(t(),i("svg",Z,s[46]||(s[46]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"1D453",d:"M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z",style:{"stroke-width":"3"}})])])],-1)]))),s[47]||(s[47]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"f")])],-1))]),s[56]||(s[56]=l(" is attention pooling, such as additive attention and scaled dot product attention in :numref:")),s[57]||(s[57]=a("code",null,"sec_attention-scoring-functions",-1)),s[58]||(s[58]=l(". The multi-head attention output is another linear transformation via learnable parameters ")),a("mjx-container",j,[(t(),i("svg",z,s[48]||(s[48]=[o("",1)]))),s[49]||(s[49]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"o")]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"o")]),a("mo",null,"×"),a("mi",null,"h"),a("msub",null,[a("mi",null,"p"),a("mi",null,"v")])])])])],-1))]),s[59]||(s[59]=l(" of the concatenation of ")),a("mjx-container",q,[(t(),i("svg",R,s[50]||(s[50]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[51]||(s[51]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[60]||(s[60]=l(" heads:"))]),a("mjx-container",S,[(t(),i("svg",O,s[61]||(s[61]=[o("",1)]))),s[62]||(s[62]=a("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"W")]),a("mi",null,"o")]),a("mrow",{"data-mjx-texclass":"INNER"},[a("mo",{"data-mjx-texclass":"OPEN"},"["),a("mtable",{columnspacing:"1em",rowspacing:"4pt"},[a("mtr",null,[a("mtd",null,[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"h")]),a("mn",null,"1")])])]),a("mtr",null,[a("mtd",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",null,"⋮")])])]),a("mtr",null,[a("mtd",null,[a("msub",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"bold"},"h")]),a("mi",null,"h")])])])]),a("mo",{"data-mjx-texclass":"CLOSE"},"]")]),a("mo",null,"∈"),a("msup",null,[a("mrow",{"data-mjx-texclass":"ORD"},[a("mi",{mathvariant:"double-struck"},"R")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"o")])])]),a("mo",null,".")])],-1))]),s[81]||(s[81]=a("p",null,"Based on this design, each head may attend to different parts of the input. More sophisticated functions than the simple weighted average can be expressed.",-1)),s[82]||(s[82]=a("h2",{id:"Implementation",tabindex:"-1"},[l("Implementation "),a("a",{class:"header-anchor",href:"#Implementation","aria-label":'Permalink to "Implementation {#Implementation}"'},"​")],-1)),a("p",null,[s[71]||(s[71]=l("In our implementation, we choose the scaled dot product attention for each head of the multi-head attention. To avoid significant growth of computational cost and parametrization cost, we set ")),a("mjx-container",I,[(t(),i("svg",P,s[63]||(s[63]=[o("",1)]))),s[64]||(s[64]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"q")]),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"k")]),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"v")]),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"o")]),a("mrow",{"data-mjx-texclass":"ORD"},[a("mo",null,"/")]),a("mi",null,"h")])],-1))]),s[72]||(s[72]=l(". Note that ")),a("mjx-container",X,[(t(),i("svg",N,s[65]||(s[65]=[a("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[a("g",{"data-mml-node":"math"},[a("g",{"data-mml-node":"mi"},[a("path",{"data-c":"210E",d:"M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z",style:{"stroke-width":"3"}})])])],-1)]))),s[66]||(s[66]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("mi",null,"h")])],-1))]),s[73]||(s[73]=l(" heads can be computed in parallel if we set the number of outputs of linear transformations for the query, key, and value to ")),a("mjx-container",W,[(t(),i("svg",G,s[67]||(s[67]=[o("",1)]))),s[68]||(s[68]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"q")]),a("mi",null,"h"),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"k")]),a("mi",null,"h"),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"v")]),a("mi",null,"h"),a("mo",null,"="),a("msub",null,[a("mi",null,"p"),a("mi",null,"o")])])],-1))]),s[74]||(s[74]=l(". In the following implementation, ")),a("mjx-container",J,[(t(),i("svg",$,s[69]||(s[69]=[o("",1)]))),s[70]||(s[70]=a("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("msub",null,[a("mi",null,"p"),a("mi",null,"o")])])],-1))]),s[75]||(s[75]=l(" is specified via the argument ")),s[76]||(s[76]=a("code",null,"num_hiddens",-1)),s[77]||(s[77]=l("."))]),s[83]||(s[83]=o("",14))])}const o1=r(e,[["render",U]]);export{t1 as __pageData,o1 as default};
